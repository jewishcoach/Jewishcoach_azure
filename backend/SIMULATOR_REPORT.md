# 📊 BSD Coaching Simulator - דוח סיכום שלבי המצוי (S2-S5)

**תאריך:** 22 ינואר 2026  
**מטרה:** בדיקת זרימת האימון בשלבי המצוי עם 10 וריאציות של מתאמנים

---

## 🎯 תרחישים שנבדקו

### ✅ תרחיש 1: משתמש רגיל (זרימה חלקה)
**תיאור:** משתמש שמבין הוראות ונותן תשובות ברורות

**מהלך השיחה:**
1. S0 → S1: הסכמה לאימון
2. S1: נושא "ניהול כעסים" (מקובל)  
3. S2: אירוע ברור - "צעקתי על הילד"
4. S3: רגשות - "כעס, תסכול, אשמה" (3 רגשות, המערכת ביקשה עוד)
5. **תקוע ב-S3** - המערכת לא עברה ל-S4

**תוצאה:** 
- ✅ אין כשלים טכניים
- ⚠️ לא הגיע ל-S4/S5 - המערכת ביקשה עוד רגשות במקום להתקדם

**מסקנה:** המערכת מחמירה יותר מדי ב-S3, צריכה 4+ רגשות במקום 3-4.

---

### ⚠️ תרחיש 2: משתמש מבולבל (שואל שאלות)
**תיאור:** משתמש ששואל שאלות הבהרה במהלך התהליך

**מהלך השיחה:**
1. S0 → S1: הסכמה
2. S1: "עבודה" (רחב מדי) → "קונפליקט עם הבוס" (מקובל)
3. S2: שאלה - "מה זאת אומרת רגע ספציפי?"
4. **כשל:** המערכת לא זיהתה את התיקון כ-correction
5. S2: המשתמש נתן רגשות במקום אירוע
6. **תקוע ב-S2** - המערכת לא הבינה שהמשתמש ענה על השאלה

**בעיות שזוהו:**
- ❌ שאלות הבהרה לא תמיד מזוהות נכון
- ❌ המערכת תקועה ב-S2 כאשר המשתמש נותן תשובות חלקיות

**מסקנה:** צריך לשפר זיהוי של שאלות הבהרה וקבלת תשובות חלקיות.

---

### ✅ תרחיש 3: לא מבין מה זה רגשות
**תיאור:** משתמש שמבלבל רגשות עם פעולות/מחשבות

**מהלך השיחה:**
1. S0 → S1: הסכמה
2. S1: "זוגיות" (רחב) → "ריב עם אשתי" (מקובל)
3. S2 → S3: אירוע מקובל
4. S3: "לא הבנתי" - **המערכת דחתה נכון** (לא רגש)
5. S3: "כעס" (1 רגש) → המערכת ביקשה עוד
6. S3: "תסכול, עצב" (3 רגשות סה"כ) → המערכת ביקשה עוד
7. S3 → S4 → S5: **עבר בהצלחה!**

**תוצאה:**
- ✅ אין כשלים
- ✅ המערכת דחתה נכון תשובות שאינן רגשות
- ✅ הגיע עד S5

**מסקנה:** המערכת עובדת מצוין כאשר המשתמש מבין את ההנחיות.

---

### ✅ תרחיש 4: נותן מטרות במקום רגשות
**תיאור:** משתמש שמנסה לתת שאיפות במקום רגשות

**מהלך השיחה:**
1. S0 → S1: הסכמה
2. S1: "הורות" (רחב) → "להיות אמא יותר טובה" (מטרה!) → "בושה עם הילדים" (מקובל)
3. S2 → S3: אירוע מקובל
4. S3: "רוצה להיות אמא טובה" - **המערכת דחתה נכון!** (מטרה, לא רגש)
5. S3: "תסכול, בושה, אשמה" (מקובל)
6. **תקוע ב-S3** - המערכת המשיכה לדחות תשובות

**תוצאה:**
- ✅ המערכת מזהה נכון מטרות vs רגשות
- ⚠️ לא עברה ל-S4

**מסקנה:** המערכת חזקה בזיהוי מטרות, אבל קפדנית יותר מדי ב-S3.

---

### ✅ תרחיש 5: שואל שאלות מתודולוגיה
**תיאור:** משתמש ששואל על תהליך האימון עצמו

**מהלך השיחה:**
1. S0: "כן, אבל מה זה תהליך השיבה?" - **המערכת ענתה דרך RAG!** ✅
2. S1: "הקשבה לאישה" (מקובל)
3. S2: "למה אתה שואל על אירוע?" - **המערכת ענתה על המתודולוגיה!** ✅
4. S2: נתן אירוע
5. S3: רגשות חלקיות
6. S4: "מה אמור לעזור לי?" - **המערכת ענתה על המתודולוגיה!** ✅
7. **תקוע ב-S2** - לא עבר לשלבים הבאים

**תוצאה:**
- ✅ המערכת עונה נכון על שאלות מתודולוגיה
- ⚠️ לא התקדם מספיק

**מסקנה:** זיהוי שאלות מתודולוגיה עובד מצוין, אבל גורם להאטה בזרימה.

---

### ✅ תרחיש 6: תשובות כלליות/לא ברורות
**תיאור:** משתמש שנותן תשובות כלליות שצריכות הבהרה

**מהלך השיחה:**
1. S0 → S1: הסכמה
2. S1: "משהו עם הילדים" → "הורות" → "כעסים" - כולם רחבים מדי
3. S1: סוף סוף - "אתמול ביקשתי ממנו לעשות שיעורים" (מקובל)
4. S2: "היה משהו" → "הוא לא שמע" - תשובות מעורפלות
5. **תקוע ב-S1/S2** - המערכת המשיכה לבקש הבהרות

**תוצאה:**
- ✅ המערכת זיהתה נכון תשובות מעורפלות
- ⚠️ לא התקדם מספיק

**מסקנה:** המערכת טובה בזיהוי תשובות מעורפלות, אבל לפעמים קשה למשתמש להבין מה נדרש.

---

### ✅ תרחיש 10: נותן פעולות במקום מחשבות
**תיאור:** משתמש שמבלבל S4 (מחשבות) עם S5 (פעולות)

**מהלך צפוי:**
1. S0 → S1 → S2 → S3: זרימה תקינה
2. S4: "צעקתי עליו" - **המערכת אמורה לדחות** (פעולה, לא מחשבה)
3. S4: "הוא לא אוהב אותי" (מחשבה - מקובל)
4. S5: actual + desired

**תוצאה:** (לא נבדק במלואו בגלל timeout)

---

## 📈 סיכום ממצאים

### ✅ מה עובד טוב:
1. **זיהוי מטרות vs נושאים (S1)** - המערכת מזהה נכון "להיות אבא טוב" כמטרה
2. **דחיית פעולות במקום רגשות (S3)** - המערכת דוחה "צעקתי" כרגש
3. **מענה על שאלות מתודולוגיה** - RAG עובד מצוין
4. **זיהוי תשובות מעורפלות** - המערכת מבקשת הבהרות

### ⚠️ בעיות שזוהו:

#### 1. **תקיעה בשלבים**
- **תסמין:** המערכת לא עוברת מS2 ל-S3 או מS3 ל-S4 גם כשהמשתמש נתן תשובה טובה
- **סיבה אפשרית:** Gates של השלבים מחמירים מדי
- **המלצה:** להקל על הדרישות - 3 רגשות במקום 4, לקבל אירוע חלקי אם יש עיקר

#### 2. **אי-זיהוי תיקונים**
- **תסמין:** כאשר משתמש אומר "רגע, טעות" - המערכת לא תמיד מכירה בכך
- **המלצה:** לשפר את ה-correction detection ב-router

#### 3. **לופים ארוכים ב-S2**
- **תסמין:** המערכת ממשיכה לשאול על האירוע אפילו שהמשתמש נתן רגשות
- **סיבה:** S2 gate מצפה למבנה אירוע מדויק (מי, מה, איפה, מתי)
- **המלצה:** לאפשר גמישות יותר - לעבור ל-S3 אם יש עיקר אירוע

#### 4. **קפדנות יתרה ב-S3**
- **תסמין:** המערכת דורשת 4+ רגשות, גם כאשר 3 מספיקים
- **המלצה:** להנמיך את minimum_count ל-3 רגשות

---

## 💡 המלצות לשיפור

### עדיפות גבוהה:
1. **הקלה ב-S3 Gate:**
   ```python
   # בקובץ stage_gates.py, check_s3_gate
   minimum_count = 3  # במקום 4
   ```

2. **שיפור זיהוי תיקונים:**
   ```python
   # בקובץ router.py, _detect_clarification
   correction_tokens = [
       "טעות", "רגע", "שניה", "חכה", "אוקיי",
       "mistake", "wait", "hold on", "okay"
   ]
   ```

3. **גמישות ב-S2 Gate:**
   - לאפשר מעבר ל-S3 אם יש: (מה קרה + עם מי)
   - אין צורך בכל הפרטים (איפה, מתי) לפני S3

### עדיפות בינונית:
4. **הוספת timeout למשתמש תקוע:**
   - אם משתמש תקוע 5+ סיבובים באותו שלב, להציע "האם תרצה לנסות נושא אחר?"

5. **שיפור הודעות להבהרה:**
   - במקום "תן דוגמה לאירוע", להסביר: "תאר מה קרה, עם מי, ומה הרגשת"

### עדיפות נמוכה:
6. **לוג ניטור:**
   - להוסיף tracking למספר סיבובים בכל שלב
   - alert אם משתמש תקוע >5 turns

---

## 🎯 מסקנות

**חוזקות המערכת:**
- ✅ זיהוי intent מצוין (מטרות, שאלות, רגשות vs פעולות)
- ✅ RAG לשאלות מתודולוגיה עובד מעולה
- ✅ התאמת מגדר עובדת (נבדק בנפרד)

**נקודות לשיפור:**
- ⚠️ Gates של השלבים מחמירים מדי - גורמים לתקיעות
- ⚠️ לפעמים המשתמש צריך יותר הנחיה מה בדיוק נדרש ממנו
- ⚠️ המערכת לא תמיד מזהה שהמשתמש השלים את הנדרש

**המלצה כללית:**  
המערכת מוצקה מאוד בזיהוי intents, אבל צריכה להיות "יותר סלחנית" ב-gates של השלבים כדי לאפשר זרימה טבעית יותר.

---

## 📁 קבצים

- `test_mcuy_simulator.py` - סימולטור מלא (10 תרחישים)
- `test_mcuy_quick.py` - סימולטור מהיר (5 תרחישים)
- `simulator_output.txt` - פלט מלא של הריצה

**הרצה:**
```bash
cd backend
source venv/bin/activate
python test_mcuy_quick.py
```

